#!/bin/bash
if [ "$1" = "ls" ]; then
    for i in $(ls -d $HOME/.vim/saved_workspaces/*/); do echo $(basename $i); done
    exit
elif [ "$1" = "open" ]; then
    export WORKSPACE="$HOME/.vim/saved_workspaces/$2/"
    CMD="nvim +'WorkspaceOpen $2' +'CocCommand explorer --no-toggle ${WORKSPACE}'"
    ENV_FILE="${WORKSPACE}.env"
    if test -f "$ENV_FILE"; then
      set -a
      source $ENV_FILE
      set +a
    fi
    SESSION_NAME="dive-$1"
    if ! { [ "$TERM" = "screen" ] || [ -n "$TMUX" ]; } then
      tmux new-session -d -s ${SESSION_NAME} "${CMD}"
      tmux attach-session -t ${SESSION_NAME}
    else
      eval "${CMD}"
    fi
else
    [ "$1" = "help" ] || echo "No such subcommand!"
    echo "Available command are:"
    echo "ls - list of projects"
    echo "open [project] - open project for editing"
fi
